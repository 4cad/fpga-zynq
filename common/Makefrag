base_dir = $(abspath ..)


$(COMMON_BOARD_NAME)_rocketchip/$(COMMON_BOARD_NAME)_rocketchip.xpr: src/verilog/rocketchip_wrapper.v src/tcl/$(COMMON_BOARD_NAME)_rocketchip.tcl
	vivado -mode tcl -source src/tcl/$(COMMON_BOARD_NAME)_rocketchip.tcl

src/verilog/rocketchip_wrapper.v: $(base_dir)/common/rocketchip_wrapper.v
	cp $(base_dir)/common/rocketchip_wrapper.v src/verilog/

src/tcl/$(COMMON_BOARD_NAME)_rocketchip.tcl: $(base_dir)/common/zynq_rocketchip.tcl
	sed 's/BOARD_NAME_HERE/$(COMMON_BOARD_NAME)/g;s/PART_NUMBER_HERE/$(PART)/g;s/# REPLACE FOR OFFICIAL BOARD NAME/set_property "board" "$(BOARD)"/g' $(base_dir)/common/zynq_rocketchip.tcl > src/tcl/$(COMMON_BOARD_NAME)_rocketchip.tcl


.PHONY: project
project: $(COMMON_BOARD_NAME)_rocketchip/$(COMMON_BOARD_NAME)_rocketchip.xpr

.PHONY: vivado_gui
vivado_gui: $(COMMON_BOARD_NAME)_rocketchip/$(COMMON_BOARD_NAME)_rocketchip.xpr
	vivado $(COMMON_BOARD_NAME)_rocketchip/$(COMMON_BOARD_NAME)_rocketchip.xpr &

.PHONY: clean
clean:
	rm -f *.log *.jou
