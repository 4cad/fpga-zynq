base_dir = $(abspath ..)

ifneq ($(BOARD_MODEL),)
    insert_board = s/\# REPLACE FOR OFFICIAL BOARD NAME/set_property "board" "$(BOARD_MODEL)"/g
endif

$(BOARD)_rocketchip/$(BOARD)_rocketchip.xpr: src/verilog/rocketchip_wrapper.v src/tcl/$(BOARD)_rocketchip.tcl
	vivado -mode tcl -source src/tcl/$(BOARD)_rocketchip.tcl
	$(post_process) # board specfic post-processing

src/verilog/rocketchip_wrapper.v: $(base_dir)/common/rocketchip_wrapper.v
	cp $(base_dir)/common/rocketchip_wrapper.v src/verilog/

src/tcl/$(BOARD)_rocketchip.tcl: $(base_dir)/common/zynq_rocketchip.tcl
	sed 's/BOARD_NAME_HERE/$(BOARD)/g;s/PART_NUMBER_HERE/$(PART)/g;$(insert_board)' $(base_dir)/common/zynq_rocketchip.tcl > src/tcl/$(BOARD)_rocketchip.tcl

.PHONY: project
project: $(BOARD)_rocketchip/$(BOARD)_rocketchip.xpr

.PHONY: vivado_gui
vivado_gui: $(BOARD)_rocketchip/$(BOARD)_rocketchip.xpr
	vivado $(BOARD)_rocketchip/$(BOARD)_rocketchip.xpr &

.PHONY: clean
clean:
	rm -f *.log *.jou
