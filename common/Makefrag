base_dir = $(abspath ..)


.PHONY: project
project: verilog tcl
	vivado -mode tcl -source src/tcl/$(BOARD)_rocketchip.tcl

src/verilog/rocketchip_wrapper.v: $(base_dir)/common/rocketchip_wrapper.v
	cp $(base_dir)/common/rocketchip_wrapper.v src/verilog/

src/verilog/fifos.v: $(base_dir)/common/fifos.v
	cp $(base_dir)/common/fifos.v src/verilog/

src/tcl/zynq_rocketchip.tcl: $(base_dir)/common/zynq_rocketchip.tcl
	sed 's/BOARD_NAME_HERE/$(BOARD)/g;s/PART_NUMBER_HERE/$(PART)/g' $(base_dir)/common/zynq_rocketchip.tcl > src/tcl/$(BOARD)_rocketchip.tcl

.PHONY: verilog
verilog: src/verilog/rocketchip_wrapper.v src/verilog/fifos.v

.PHONY: tcl
tcl: src/tcl/zynq_rocketchip.tcl

.PHONY: clean
clean:
	rm -f *.log *.jou
