base_dir = $(abspath ..)


$(BOARD)_rocketchip/$(BOARD)_rocketchip.xpr: src/verilog/rocketchip_wrapper.v src/tcl/$(BOARD)_rocketchip.tcl
	vivado -mode tcl -source src/tcl/$(BOARD)_rocketchip.tcl

src/verilog/rocketchip_wrapper.v: $(base_dir)/common/rocketchip_wrapper.v
	cp $(base_dir)/common/rocketchip_wrapper.v src/verilog/

src/tcl/$(BOARD)_rocketchip.tcl: $(base_dir)/common/zynq_rocketchip.tcl
	sed 's/BOARD_NAME_HERE/$(BOARD)/g;s/PART_NUMBER_HERE/$(PART)/g;s/# REPLACE FOR OFFICIAL BOARD NAME/set_property "board" "$(BOARD_MODEL)"/g' $(base_dir)/common/zynq_rocketchip.tcl > src/tcl/$(BOARD)_rocketchip.tcl


.PHONY: project
project: $(BOARD)_rocketchip/$(BOARD)_rocketchip.xpr

.PHONY: vivado_gui
vivado_gui: $(BOARD)_rocketchip/$(BOARD)_rocketchip.xpr
	vivado $(BOARD)_rocketchip/$(BOARD)_rocketchip.xpr &

.PHONY: clean
clean:
	rm -f *.log *.jou
